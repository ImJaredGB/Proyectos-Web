{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{% static 'app/styles.css' %}">
    <link href="https://fonts.googleapis.com/css?family=Inter:400,700&display=swap" rel="stylesheet">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendario</title>
</head>

<body>
    
    <!--Navigation bar-->
    <div class="header">
        <nav>
            <ul>
                <li><a href="/home">Calendario</a></li>
                <li><a href="/habitaciones" >Habitaciones</a></li>
                <li><a href="/usuarios" class="active">Usuarios</a></li>
            </ul>
        </nav>
    </div>

    
    <!--Main content area-->
    <div class="main-content">


        <!--Data table-->
        <div id="tabla-habitaciones">
            <table class="tabla-habitaciones">
                <thead>
                    <tr>
                        <th>Nombres</th>
                        <th>Apellidos</th>
                        <th>Numero de documento</th>
                        <th>Llegada</th>
                        <th>Salida</th>
                        <th>Info. Adicional</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Las filas se generarán dinámicamente con JavaScript -->
            </table>
        </div>

        <!--Tool Sidebar-->
        <div class="tool-sidebar">
            <ul>
                <li><button>Agregar usuario</button></li>
                <li><button>Editar usuario</button></li>
            </ul>
        </div>
    </div>

    <!-- Modal para ver info de usuario -->
    <div id="modal-info" class="modal-info" style="display:none;">
        <div class="modal-content">
            <button id="close-modal" class="close-modal-btn">✕</button>
            <h2>Información del usuario</h2>
            <div id="modal-data"></div>
            <div id="modal-qr" style="margin: 20px 0;"></div>
            <button class="send-email-btn">Enviar al correo</button>
        </div>
    </div>

    <!--Animations and functions-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
        // Modal logic
        function mostrarModalInfo(usuario) {
            const modal = document.getElementById('modal-info');
            const modalData = document.getElementById('modal-data');
            const modalQR = document.getElementById('modal-qr');
            modal.style.display = 'flex';

            modalData.innerHTML = `
                <div style="margin-bottom:16px;">
                    <strong>Zona:</strong> ${usuario.zona}<br>
                    <strong>Habitación:</strong> ${usuario.habitacion}<br>
                    <strong>Litera:</strong> ${usuario.habitacion}_${usuario.litera}<br>
                </div>
            `;

            modalQR.innerHTML = "";
            // Info para QR
            const qrInfo = `
                Documento: ${usuario.documento}
            `;
            new QRCode(modalQR, {
                text: qrInfo,
                width: 160,
                height: 160,
                colorDark : "#1D1D1D",
                colorLight : "#fff",
                correctLevel : QRCode.CorrectLevel.L
            });
        }

        // Cerrar modal
        document.getElementById('close-modal').onclick = function() {
            document.getElementById('modal-info').style.display = 'none';
        };

        // Cargar usuarios desde el backend y mostrarlos en la tabla
        function cargarUsuarios() {
            fetch('/api/usuarios/listar/')
                .then(response => response.json())
                .then(data => {
                    const tbody = document.querySelector(".tabla-habitaciones tbody");
                    tbody.innerHTML = "";

                    data.usuarios.forEach(usuario => {
                        const fila = document.createElement("tr");

                        fila.innerHTML = `
                            <td>${usuario.nombre || "-"}</td>
                            <td>${usuario.apellido || "-"}</td>
                            <td>${usuario.documento || "-"}</td>
                            <td>${usuario.llegada || "-"}</td>
                            <td>${usuario.salida || "-"}</td>
                            <td><button onclick='mostrarModalInfo(${JSON.stringify(usuario)})'>Ver más</button></td>
                            <td>${usuario.estado ? "Activo" : "Inactivo"}</td>
                        `;

                        tbody.appendChild(fila);
                    });
                })
                .catch(error => {
                    console.error("Error al cargar usuarios:", error);
                });
        }

        // Llamar al cargar la página
        window.onload = cargarUsuarios;
    </script>
</body>
</html>